<div class="row">
	<div class="col-md-12">
		<h1 class="study-lead">Gene<%= action_name =~ /set/ ? ' Set' : nil %> Expression for <%= render partial: 'gene_name_list' %><%= render partial: 'missing_genes' %></h1>
		<% if action_name =~ /set/ %>
			<h3 class="help-block lead">Expression scores are shown as an average across all queried genes for each cell.</h3>
		<% end %>
	</div>
</div>
<div class="row">
	<div class="col-md-3" id="search-target">
		<%= render partial: 'search_render_options' %>
	</div>
	<div class="col-md-9" id="render-target">
		<%= render partial: 'expression_plots_view' %>
	</div>
</div>

<%= javascript_tag do %>

	<%= render partial: 'expression_plots_plotly' %>

	// listener for cluster nav, specific to expression pages
	$("#cluster").change(function() {
		var url = '<%= params[:gene] ? render_gene_expression_plots_path(study_name: params[:study_name], gene: params[:gene]) : render_gene_set_expression_plots_path(study_name: params[:study_name], search: {gene_set: params[:search][:gene_set]}) %>';
		var target1 = document.getElementById('expression-plots');
		var spinner1 = new Spinner(opts).spin(target1);
		$(target1).data('spinner', spinner1);
		var cluster = $('#cluster').val();
		if (cluster == "") {
			$.get(url);
		} else {
			var delimeter = "<%= params[:gene] ? "?".html_safe : "&".html_safe %>";
			$.get(url + delimeter + 'cluster=' + cluster);
		}
	});

	// re-render expression plots on window resize to use available area
	$( window ).on('resizeEnd', function() {

		<%= render partial: 'expression_box_layout' %>

		<%= render partial: 'expression_scatter_layout' %>

		<%= render partial: 'static_scatter_layout' %>

		Plotly.newPlot('box-plot', expressionData, expressionLayout);
		Plotly.newPlot('scatter-plot', clusterData, scatterLayout);
		Plotly.newPlot('reference-plot', data, staticLayout, {staticPlot: true});
	});

<% end %>