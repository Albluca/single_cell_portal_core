// load each cluster into a single variable to have multiple tracks
<% @coordinates.each_with_index do |(cluster, data), index| %>
var <%= cluster %> = {
	x: <%= raw data[:x] %>,
	y: <%= raw data[:y] %>,
	text: <%= raw data[:text] %>,
	name: "<%= data[:name] %>",
	mode: 'markers',
	type: 'scatter',
};

<% end %>

// populate data array for showing legend
var data = [];
<% @coordinates.each_key do |cluster| %>
	data.push(<%= cluster %>);
<% end %>

Plotly.newPlot('cluster-plot', data, {hovermode: 'closest'});

// set the cluster field in the search box to scope search correctly
$('#search_cluster').val("<%= params[:cluster] %>");
// re-highlight cluster nav
$('.cluster-nav').removeClass('active');
$("#<%= params[:cluster] %>").addClass('active');

// stop spinner
$('#<%= params[:cluster] %>').data('spinner').stop();
