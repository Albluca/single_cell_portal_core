// check render status
console.log('render status of box plot at start: ' + $('#expression-plots').data('box-rendered'));
console.log('render status of scatter plot at start: ' + $('#expression-plots').data('scatter-rendered'));
console.log('render status of reference plot at start: ' + $('#expression-plots').data('reference-rendered'));

$('#expression-plots').html("<%= escape_javascript(render partial: @top_plot_partial)%>");

$('#box-controls, #scatter-plots').on('show.bs.collapse hide.bs.collapse', function() {
	toggleGlyph($(this).prev().find('span.toggle-glyph'));
});

<%= render partial: @top_plot_plotly %>

$('#toggle-traces').tooltip({container: 'body', placement: 'left', trigger: 'hover'});

// clear listeners and reattach
$( window ).off('resizeEnd', "**");

$( window ).on('resizeEnd', function() {

	<%= render partial: @top_plot_layout %>

	<%= render partial: 'expression_scatter_layout' %>

	<%= render partial: 'static_scatter_layout' %>

	Plotly.newPlot('box-plot', expressionData, expressionLayout);
	Plotly.newPlot('scatter-plot', clusterData, scatterLayout);
	Plotly.newPlot('reference-plot', data, staticLayout);
});

// attach click event for toggle switch
$('#toggle-traces').click(function() {
    togglePlotlyTraces('box-plot');
});

// monitor rendering for tests
$('#expression-plots').data('box-rendered', true);
$('#expression-plots').data('scatter-rendered', true);
$('#expression-plots').data('reference-rendered', true);

// check render status
console.log('render status of box plot at end: ' + $('#expression-plots').data('box-rendered'));
console.log('render status of scatter plot at end: ' + $('#expression-plots').data('scatter-rendered'));
console.log('render status of reference plot at end: ' + $('#expression-plots').data('reference-rendered'));