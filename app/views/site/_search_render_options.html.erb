<div class="panel panel-info" id="search-options-panel">
	<div class="panel-heading">
		<div class="panel-title">
			<h4>Search/View Options <span class='fa fa-cog'></span><span class='btn btn-sm btn-danger pull-right' style='margin-top: -5px;' data-toggle="tooltip" title="Collapse Options" data-placement="left"><span class='fa fa-chevron-left '></span></span></h4>
			<%= link_to "", 'javascript:toggleSearch();' %>
		</div>
	</div>
	<div class="panel-body">
		<div class="row">
			<div class="col-sm-12">
				<%= form_for(:search, url: search_genes_path(@study.url_safe_name), html: {class: 'form', id: 'search-genes-form'}) do |f| %>
					<%= f.hidden_field :cluster, value: params[:cluster] %>
					<%= f.hidden_field :boxpoints, value: params[:boxpoints] %>
					<div class="form-group">
						<%= f.label :genes, 'Search for genes of interest (space delimited)' %>
						<%= f.text_field :genes, {class: 'form-control search-genes-input', placeholder: 'Search genes...', value: set_search_value} %>
					</div>
					<div class="form-group">
						<%= f.label :upload, "Or upload a list of genes (one gene per line)" %><br>
						<%= f.file_field :upload, class: 'btn btn-default search-genes-input' %>
					</div>
					<%= link_to "<span class='fa fa-ban'></span> Clear Search".html_safe, "javascript:clearForm('search_genes');", class: 'btn btn-warning pull-right' %>
					<%= link_to "<span class='fa fa-search'></span> Search Genes ".html_safe, "javascript:;", class: 'btn btn-success', id: 'submit-gene-search' %>
					<%= javascript_tag do %>
						$('#submit-gene-search').click(function() {
							if ( $('#search_genes').val() == '' && $('#search_upload').val() == '' ) {
								alert('You must specify at least one gene or upload a list of genes to search');
								setErrorOnBlank($('.search-genes-input'));
							} else {
								$('#search-genes-form').submit();
							}
						});
					<% end %>
				<% end %>
			</div>
		</div>
		<hr />
		<div class="row">
			<div class="col-sm-12">
				<%= label_tag :gene_set_modal, 'Search for genes of interest as set' %>
				<%= link_to "Open Search Form", '#', class: 'btn btn-info', 'data-toggle' => 'modal', 'data-target' => '#gene-set-modal' %>
				<div class="modal fade" id="gene-set-modal" tabindex="-1" role="dialog" aria-labelledby="gene-set-modal" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<h4 class="modal-title">View Gene Set Expression<button class="close" data-dismiss="modal">Ã—</button></h4>
							</div>
							<div class="modal-body">
								<%= form_for(:search_gene_sets, url: search_gene_sets_path, html: {class: 'form', id: 'gene-set-search-form', multipart: true}) do |f| %>
									<%= f.label :gene_set, "Paste in your gene set to view expression scores averaged across all genes" %><br>
									<%= f.text_area :gene_set, value: !params[:search].nil? ? params[:search][:gene_set] : nil, class: 'form-control search-gene-set-input' %>

									<div class="form-group">
										<%= f.label :upload, "Or upload a gene set file (one per line)" %><br>
										<%= f.file_field :upload, class: 'btn btn-default search-gene-set-input' %>
									</div>

									<hr />
									<%= link_to "<span class='fa fa-ban'></span> Clear Search".html_safe, "javascript:clearForm('search_gene_sets_gene_set');", class: 'btn btn-warning pull-right' %>
									<%= link_to "<span class='fa fa-search'></span> Search Genes ".html_safe, "javascript:;", class: 'btn btn-success', id: 'submit-gene-set-search' %>
									<%= javascript_tag do %>
										$('#submit-gene-set-search').click(function() {
											if ( $('#search_genes').val() == '' && $('#search_upload').val() == '' ) {
												alert('You must specify at least one gene or upload a list of genes to search');
												setErrorOnBlank($('.search-gene-set-input'));
											} else {
												$('#gene-set-search-form').submit();
											}
										});
									<% end %>
								<% end %>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<hr />
		<% if action_name =~ /(set|heatmap)/ && action_name !~ /(all|precomputed)/ %>
			<div class="row">
				<div class="col-sm-12">
					<%= label_tag :gene, 'Load single gene-level expression' %><br />
					<%= select_tag :gene, options_for_select(load_gene_nav(@genes, params[:cluster])), {class: 'form-control'} %>
					<br />
					<%= javascript_tag do %>
						$('#gene').change(function() {
						window.location.href = $(this).val();
						});

					<% end %>
				</div>
			</div>
			<hr />
		<% end %>
		<div class="row">
			<div class="col-sm-12">
				<%= label_tag :expression, 'Load pre-computed expression scores' %><br />
				<%= select_tag :expression, options_for_select(@precomputed, set_precompute_selection), {include_blank: true, class: 'form-control'} %>
				<%= javascript_tag do %>

					$("#expression").change(function() {
						window.location.href = $(this).val();
					});

				<% end %>

			</div>
		</div>
		<hr />
		<% if action_name !~ /(all|precomputed)/ %>
			<div class="row">
				<div class="col-sm-12">
					<%= label_tag :cluster, 'Load a sub-cluster' %><br />
					<%= select_tag :cluster, options_for_select(@options, params[:cluster]), class: 'form-control' %>
				</div>
			</div>
		<% end %>
		<% if action_name =~ /heatmap/ %>
			<hr />
			<div class="row">
				<div class="col-sm-12">
					<%= label_tag :centered, 'Row centering' %> <span class="fa fa-question-circle" data-toggle="tooltip" data-placement="right" title="For every value in each row, subtract the mean of the entire row from the value"></span><br />
					<%= check_box_tag :centered, nil, params[:centered] == "1" %>
				</div>
			</div>
		<% end %>
	</div>
</div>