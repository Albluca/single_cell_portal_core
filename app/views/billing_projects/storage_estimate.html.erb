<div class="row">
  <div class="col-sm-4 text-center">
    <h1>Project<br /><span class="label label-default"><%= params[:project_name] %></h1>
  </div>
  <div class="col-sm-4 text-center">
    <h1>Cost Estimate<br /><span class="label label-primary"><span id="selected-cost"><%= number_to_currency(@total_cost) %></span>/month</span></h1>
  </div>
  <div class="col-sm-4 text-center">
    <h1>Workspaces<br /><span class="text-right label label-success"><span id="selected-count"><%= @workspaces.size %></span> selected</span></h1>
  </div>
</div>
<div class="bs-callout bs-callout-default">
  <h4>Storage Cost Breakdown</h4>
  <p class="help-block">Use the table below to find per-workspace storage costs.  Filtering workspaces will update the total cost estimate to only calculate the currently displayed entries.</p>
</div>
<div class="row">
  <div class="col-xs-12 text-center">

  </div>
  <div class="col-md-12">
    <div class="table-responsive">
      <table class="table table-striped table-condensed" id="workspace-costs">
        <thead>
        <tr>
          <th>Workspace</th>
          <th>Monthly Cost Estimate</th>
        </tr>
        </thead>
        <tbody>
        <% @workspaces.sort_by {|workspace, cost| -cost}.each do |workspace, cost| %>
          <tr>
            <td class="workspace-name"><%= workspace %></td>
            <td class="workspace-cost"><%= number_to_currency(cost) %></td>
          </tr>
        <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script type="text/javascript">
    var costTable = $('#workspace-costs').DataTable({
        columns: [
            {data: 'workspace_name'},
            {data: 'workspace_cost', type: 'num-fmt'}
        ],
        pagingType: "full_numbers",
        order: [[1, 'desc']],
        language: {
            search: "Filter Results By: "
        }
    });

    costTable.on('search.dt', function() {
        var rows = costTable.rows({filter: 'applied'});
        var sum = 0.0;
        rows.data().each(function(row) {
            // convert dollar amount to float
            var cost = Number(row.workspace_cost.replace(/[^0-9\.-]+/g,""));
            sum += cost;
        });
        $('#selected-cost').html("$" + sum.toFixed(2));
        $('#selected-count').html(rows.data().length);
    });

</script>